---
layout:     post
title:      计算机图形学（六）——材质与外观（Ray Tracing）
date:       2020-05-19
author:     XPX
header-img: img/post-bg-desk.jpg
catalog: true
tags:
    - 计算机图形学
---

## 材质

### 漫反射材质的特性

渲染过程中表现出的不同特性是由BRDF决定的。BRDF定义的是光打在一点上向四周的辐射的强度。而对于漫反射材质，就是光线打在一个点上，会被均为地反射到半球空间上。

![image-20200519214126212](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519214126212.png)

下图中的左边和右边都是均匀的漫反射材质渲染之后的图片，不同之处在于漫反射的系数不同。所谓漫反射系数，就是在不同通道上的比例。

![image-20200519214342041](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519214342041.png)

当材质不吸收光的能量且为漫反射，意味着射入的光线强度等于反射的所有光线强度之和。且反射光线强度在半球上均匀分布即$L_i=constant$，BRDF函数$f_r=constant$，与入射角度无关。根据反射模型：
$$
\begin{aligned}
L_o(\omega_o)&=\int_{H^2}f_rL_i(\omega_i)\cos\theta_id\omega_i\\
&=f_rL_i\int_{H^2}\cancel{\omega}\cos\theta_id\omega_i\\
&=\pi f_rL_i
\end{aligned}
$$
由于入射光线等于反射光线即$L_o==L_i$，所以有$f_r=1/\pi$。

我们定义一个反射率（albedo）用来定义不同颜色的系数：
$$
f_r=\frac{\rho}{\pi}
$$

### 高光材质（Glossy）

高光材质表面和镜面类似，但由于其表面较粗糙，所以反射光分布在放射方向周围。

![image-20200519221243517](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519221243517.png)

高光材质的渲染图片如下图所示，和漫反射一样，通过控制系数可以调整最终呈现的颜色。

![image-20200519221421215](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519221421215.png)

### 半透明材质

半透明材质既有反射也有折射

![image-20200519221525303](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519221525303.png)

下图为半透明材质的渲染图，右边的玻璃内实际是有颜色的，这说明光线进入玻璃后多次反射后又射出。

![image-20200519221644181](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519221644181.png)

## 反射

如左图所示，在反射中，入射光与反射光关于法线对称。我们发现入射光和反射光的向量相加会得到
$$
\omega_o+\omega_i=2\cos\theta\vec{\bold{n}}=2(\omega_i\cdot\vec{\bold{n}})\vec{\bold{n}}
$$
因此反射光的方位角 $\omega_o$ 为：
$$
\omega_o=-\omega_i+2(\omega_i\cdot\vec{\bold{n}})\vec{\bold{n}}
$$


<img src="https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519221921972.png" alt="image-20200519221921972"  />

在俯视角度上，出射的方位角$\Phi_o$与入射方位角$\Phi_i$相差$\pi$，如右图所示。因此俯视角度上的出射角度$\Phi_o$为：
$$
\Phi_o=(\Phi_i+\pi)\text{mod}2\pi
$$

## 折射

### 斯内尔定律（Snell Law）

在折射中，入射角和折射角满足定律：$\eta_i\sin\theta_i=\eta_t\sin\theta_t$。下图右边列出的是多个材质的折射率。真空的折射率为1.0，钻石的折射率为2.42，由于钻石折射率较大，不同波长的光波经过折射后出射角度不同，因此可以看到多种颜色的光。

![image-20200519223644830](https://xpx-picbed.oss-cn-beijing.aliyuncs.com//blog/2020/05/image-20200519223644830.png)

出射角的余弦可以计算得到：
$$
\begin{aligned}
\cos \theta_{t} &=\sqrt{1-\sin ^{2} \theta_{t}} \\
&=\sqrt{1-\left(\frac{\eta_{i}}{\eta_{t}}\right)^{2} \sin ^{2} \theta_{i}} \\
&=\sqrt{1-\left(\frac{\eta_{i}}{\eta_{t}}\right)^{2}\left(1-\cos ^{2} \theta_{i}\right)}
\end{aligned}
$$
可以发现只有当$1-\left(\frac{\eta_{i}}{\eta_{t}}\right)^{2}\left(1-\cos ^{2} \theta_{i}\right)>=0$的时候出射角才有意义。通过分析这个公式可以得到，只有当入射介质的折射率大于出射介质的折射率时才会出现无意义的情况。