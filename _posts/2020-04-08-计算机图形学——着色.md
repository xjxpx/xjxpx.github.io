---
layout:     post
title:      计算机图形学——着色（Shading）
date:       2020-04-08
author:     XPX
header-img: img/post-bg-desk.jpg
catalog: true
tags:
    - 计算机图形学
---

### 画家算法

在将场景投影到平面之前，还需要处理物体之间的遮挡关系。比如下面这张图左边的景色，在屏幕中成像的顺序根据远近分别为雪山、草地、树木。而在正方体图形中，成像顺序是先成像最远的面，再成像周围四个面，最后是最近的面。对于周围的四个面也需要设置一定的顺序使视图符合物理规则。

<center>
    <img
    src="https://raw.githubusercontent.com/xjxpx/xjxpx.github.io/master/img/2020/04/shading-cover1.png">
</center>

但是对于下面这种摆放的物体，任何顺序都没有办法完全实现图中表述的位置关系。

<center>
    <img
    src="https://raw.githubusercontent.com/xjxpx/xjxpx.github.io/master/img/2020/04/shading-cover2.png">
</center>


### Z Buffer

在实际使用中，我们不会用画家算法渲染图像，而是使用Z Buffer方法。Z Buffer方法有几个特点：

- 对每个图像中的像素存储当前最小的z值
- 需要一个额外的buffer存储深度值（这也是Z Buffer名称的由来）
    - frame buffer
    - depth buffer (为了简明性，我们认为z永远是正的)

Z-Buffer 算法
```
for (each triangle T)
    for (each sample(x,y,z) in T)
        if (z < zbuffer[x,y])
            framebuffer[x,y] = rgb
            zbuffer[x,y] = z
```

复杂度： 对于n个三角形，计算复杂度为O（n）,但对于n个三角形的处理，可以使用多线程加快处理速度。

### 着色 （Shading）

着色表示对不同材料应用不同属性
根据材质和位置不同，反光区域分为
- 镜面高光区域（Specular highlights）
- 漫反射区域 （Diffuse reflection）
- 环境光区域 (Ambient lighting)
#### 漫反射

漫反射的亮度和表面法向量和光源的夹角有关，夹角越小接受的能量越大，越明亮。
<center>
    <img
    src="https://raw.githubusercontent.com/xjxpx/xjxpx.github.io/master/img/2020/04/shading-diffuse_reflection.png">
</center>

此外表面亮度还和距离光源的远近有关，光强与距离的平方成反比。
<center>
    <img
    src="https://raw.githubusercontent.com/xjxpx/xjxpx.github.io/master/img/2020/04/shading-fall_off.png">
</center>

因此漫反射光的计算公式如下图，包括漫反射系数、不同距离的能量强度和反射面夹角这三个影响因素。**对于漫反射，观测的角度不会影响表面的亮度，因为漫反射表面会均匀地向四周发射光波**。
<center>
    <img
    src="https://raw.githubusercontent.com/xjxpx/xjxpx.github.io/master/img/2020/04/shading-diffuse_energy.png">
</center>
